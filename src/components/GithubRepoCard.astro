---
import { z } from 'zod'
import { ghProfile } from '../schemas/github'

interface Props {
  repo: z.infer<typeof ghProfile>['data']['user']['pinnedItems']['edges'][0]
}

const { repo } = Astro.props
---

<github-repo-card data-repourl={repo.node.url}>
  <div
    class="cursor-pointer bg-white text-gray-500 p-6 shadow-md hover:shadow-lg transition-shadow duration-300 ease-in"
  >
    <div class="flex items-center mb-1">
      <svg aria-hidden="true" class="mr-2 min-w-4" height="16" role="img" viewBox="0 0 12 16" width="12">
        <path
          fill-rule="evenodd"
          d="M4 9H3V8h1v1zm0-3H3v1h1V6zm0-2H3v1h1V4zm0-2H3v1h1V2zm8-1v12c0 .55-.45 1-1 1H6v2l-1.5-1.5L3 16v-2H1c-.55 0-1-.45-1-1V1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1zm-1 10H1v2h2v-1h3v1h5v-2zm0-10H2v9h9V1z"
        ></path>
      </svg>
      <p class="text-gray-800 text-2xl font-medium whitespace-nowrap text-ellipsis overflow-hidden">
        {repo.node.name}
      </p>
    </div>
    <p class="overflow-hidden mb-6">{repo.node.description}</p>
    <div class="flex justify-between text-xs text-200">
      <div class="flex flex-grow gap-2">
        {
          repo.node.primaryLanguage !== null && (
            <span class="flex items-center gap-1">
              <div class="w-3 h-3 rounded-full" style={{ backgroundColor: repo.node.primaryLanguage.color }} />
              <p>{repo.node.primaryLanguage.name}</p>
            </span>
          )
        }
        <span class="flex items-center gap-0.5">
          <i class="i-fa6-solid-code-fork"></i>
          <p>{repo.node.forkCount}</p>
        </span>
        <span class="flex items-center gap-0.5">
          <i class="i-fa6-solid-star"></i>
          <p>{repo.node.stargazers.totalCount}</p>
        </span>
      </div>
      <div class="repo-right-stat">
        <p>{repo.node.diskUsage}</p>
      </div>
    </div>
  </div>
</github-repo-card>

<script>
  class GithubRepoCard extends HTMLElement {
    constructor() {
      super()

      const repoUrl = this.dataset.repourl
      this.addEventListener('click', () => {
        const win = window.open(repoUrl, '_blank')
        win!.focus()
      })
    }
  }

  customElements.define('github-repo-card', GithubRepoCard)
</script>
